# Dangerous ACLs expose GPOs applied to privileged group members (attack path)
üóìÔ∏è Published: 2025-05-06


## 1. Introduction

### What is a control path in Active Directory

A control path in Active Directory refers to a sequence of permissions that allows a user or group to gain control over a target object, either directly or indirectly, by chaining access rights across multiple objects.
In simpler terms, it‚Äôs the ‚Äúpath‚Äù that an attacker could follow‚Äîvia delegated permissions, misconfigured ACLs, or inherited rights‚Äîto escalate privileges or compromise critical AD components.
Control paths are typically built using:
- Access Control Entries (ACEs) that allow rights like GenericAll, WriteDacl, WriteOwner, or AllExtendedRights.
- Object relationships, such as Group Membership, OU delegation, or GPO application.
- Privilege boundaries not being respected (e.g., standard users controlling GPOs linked to Domain Admins).

These paths are often non-obvious and span multiple AD layers. A user might not have direct rights over a Domain Admin account, but might control a GPO applied to it, or be able to modify an object that eventually affects it.

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-06-22-53-21.png)

This diagram illustrates a privilege escalation control path in Active Directory:

- UserA has GenericWrite rights on Group1, allowing them to modify its membership.
- Group1 is a member of GPOE2, so UserA indirectly gains influence over GPOE2.
- GPOE2 has GPOEdit rights on GPO_Admins, meaning its members can edit the GPO.
- GPO_Admins is applied to the Domain Admins OU ‚Äî any changes to this GPO affect Domain Admins.
‚û°Ô∏è Result: UserA can escalate privileges and potentially compromise Domain Admins via this chain of misconfigured permissions.

### Why misconfigured ACLs are dangerous

Access Control Lists (ACLs) in Active Directory define who can interact with directory objects and what actions they can perform ‚Äî from reading attributes to modifying group memberships or delegating control.
When ACLs are misconfigured, they can unintentionally grant users or groups privileged access over critical objects such as:
- Group Policy Objects (GPOs)
- Organizational Units (OUs)
- Security groups (including Domain Admins)
- User or computer accounts

This creates opportunities for privilege escalation, persistence mechanisms, and even full domain compromise. Attackers often exploit these weaknesses post-compromise, using tools like BloodHound to identify and follow control paths that stem from over-permissive ACLs.

Even a single ACE (Access Control Entry) granting GenericAll, WriteDACL, or GenericWrite on a sensitive object can be the starting point of a complete Active Directory takeover.
ACLs are especially dangerous when:
- Inheritance is enabled inappropriately.
- Legacy delegation models are still in place.
- Groups like Authenticated Users or Domain Users are granted write permissions to privileged objects.

### Typical exploitation context: post-compromise attacks, persistence, privilege escalation.

Once an attacker has initial access in an Active Directory environment ‚Äî often as a low-privileged user ‚Äî they will look for misconfigured ACLs to move laterally or escalate privileges.
Here are common scenarios:
- üß¨ GPO Hijacking: An attacker with edit rights on a GPO applied to privileged users can deploy malicious logon scripts or scheduled tasks to execute code with elevated privileges.
- üîÅ Group Membership Manipulation: With GenericWrite or WriteMembers rights over a group, an attacker can add themselves to a group that is indirectly linked to high privileges.
- üîì WriteDACL Abuse: The ability to modify an object‚Äôs ACL allows the attacker to grant themselves full control (GenericAll), effectively owning the object.
- üß± OU Delegation Abuse: Poorly delegated permissions at the OU level can expose multiple child objects (users, groups, computers) to compromise.

These attack techniques are not theoretical ‚Äî they have been observed in real-world breaches, and often form the core of post-exploitation playbooks using tools like BloodHound, PowerView, or ADExplorer.

---

## 2. Root Cause of the Vulnerability

This article specifically focuses on a critical misconfiguration scenario:
"Dangerous ACLs exposing Group Policy Objects (GPOs) that are applied to privileged group members", such as Domain Admins, Enterprise Admins, or other Tier 0 accounts.

In this case, the root cause lies in excessive or poorly managed permissions set on GPO objects in Active Directory. These permissions are stored in two places:

- The LDAP object representing the GPO (in CN=Policies,CN=System,...)
- The corresponding SYSVOL folder that stores the actual GPO scripts and policies

When any user or group has write access (GpoEdit, Write, GenericWrite, WriteDACL, etc.) to one of these layers, they can:

- Modify GPO settings to run malicious scripts
- Apply registry modifications
- Alter login/logoff behavior for privileged users

### Common Root Causes

* GPOs linked to privileged user scopes (e.g., OU containing Domain Admins) are not secured and allow modification by non-Tier 0 users.
* Legacy delegation models that granted permissions to groups like ITSupport, HelpDesk, or even Authenticated Users.
* ACL drift: Permissions in LDAP are not kept in sync with permissions in the SYSVOL folder.
* Inherited permissions allow downstream access unintentionally.
* Azure AD Connect service accounts or other delegated identities are over-permissioned for convenience.

### Consequences

If a GPO applied to a privileged group is compromised, an attacker can:
- Run code as a Domain Admin at logon
- Maintain persistence by continuously reapplying malicious settings
- Pivot to other systems with higher privileges

---

## 3. How an Attacker Exploits This Vulnerability

Misconfigured ACLs on GPOs applied to privileged users open a direct and often invisible path for attackers to escalate privileges or maintain long-term persistence in an Active Directory environment.

### Example Exploitation Path

Let‚Äôs walk through a concrete scenario:

1. Initial foothold: The attacker compromises UserA, a standard domain user.
2. Privilege reconnaissance: Using tools like BloodHound, the attacker identifies that UserA has GenericWrite rights over Group1.
3. Lateral control: Group1 is a member of Group2, which has GpoEdit rights over GPO_Admins.
4. Privilege escalation: GPO_Admins is linked to the OU that contains Domain Admins.
5. Attack execution: The attacker edits the GPO to deploy a logon script or scheduled task that executes malicious code as a Domain Admin during their next logon.
‚û°Ô∏è In just a few steps, the attacker has moved from a low-privileged account to full domain control.

### Techniques Used

* BloodHound: To map Active Directory relationships and identify exploitable control paths (queries like "Shortest path to Domain Admins").
* GPMC / PowerView: To list and analyze GPO permissions (e.g., Get-GPPermissions).
* Malicious GPO payloads:
    * Logon/logoff scripts
    * Startup scripts
    * Scheduled tasks
    * Registry modifications (e.g., Run key persistence)

### Why This Works

In many environments:

* GPOs are not treated as Tier 0 objects, even when linked to Tier 0 users.
* Delegation is often excessive, and not reviewed regularly.
* SYSVOL permissions may not be synchronized with LDAP ACLs.
* No auditing or alerting is configured for changes on sensitive GPOs.

This makes GPOs an attractive and stealthy vector for attackers, especially because GPO changes are rarely flagged by traditional endpoint or SIEM solutions.

---

## 4. Detection

There are several tools available to detect dangerous ACLs in Active Directory‚Äîsuch as BloodHound or PingCastle‚Äîwhich are widely used for visualizing attack paths and assessing overall AD health.
‚û°Ô∏è However, this article focuses on PowerShell-based detection, offering a direct and scriptable way to audit GPO permissions and identify exposure points.

### Identify GPOs with Edit Permissions

To list all GPOs where users or groups have edit-level permissions (such as GpoEdit, GpoEditDeleteModifySecurity, etc.):

```powershell
Get-GPO -All | ForEach-Object {
    $gpoName = $_.DisplayName
    Get-GPPermissions -Name $gpoName -All | Where-Object {
        $_.Permission -like "*Edit*"
    } | Select-Object @{Name="GPOName";Expression={$gpoName}},
                         @{Name="Trustee";Expression={$_.Trustee.Name}},
                         TrusteeType,
                         Permission
}
```

Example :

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-07-00-24-44.png)


If you need a version that exclude Built-in trustees (like "Domain Admins", "Enterprise Admins", "SYSTEM"),
you can use this version of the script :

```powershell
$allowed = "Domain Admins", "Enterprise Admins", "SYSTEM"

Get-GPO -All | ForEach-Object {
    $gpoName = $_.DisplayName
    Get-GPPermissions -Name $gpoName -All | Where-Object {
        $_.Permission -like "*Edit*" -and ($allowed -notcontains $_.Trustee.Name)
    } | Select-Object @{Name="GPOName";Expression={$gpoName}},
                         @{Name="Trustee";Expression={$_.Trustee.Name}},
                         TrusteeType,
                         Permission
}
```
Example :

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-07-00-27-43.png)

This will highlight any GPO where a non-Tier 0 Built-in group may have control.



### Identify GPOs Linked to Privileged Scopes

You can also find which GPOs are linked to OUs containing privileged users, such as Domain Admins or other Tier 0 accounts:

```powershell
# üîß Define keywords that identify privileged OUs or scopes
$SensitiveOUKeywords = @(
    "Domain Controllers",
    "PRIVILEGED",
    "Domain Admins",
    "Tier0",
    "Tier 0"
)

# üì¶ Initialize a list to store GPOs linked to sensitive scopes
$gposAtRisk = @()

# üîç Analyze all GPOs
Get-GPO -All | ForEach-Object {
    $gpo = $_
    try {
        $xml = [xml](Get-GPOReport -Guid $gpo.Id -ReportType Xml)
        $links = $xml.GPO.LinksTo.SOMPath

        foreach ($link in $links) {
            foreach ($keyword in $SensitiveOUKeywords) {
                if ($link -like "*$keyword*") {
                    $gposAtRisk += [PSCustomObject]@{
                        GPOName  = $gpo.DisplayName
                        LinkedTo = $link
                        Matched  = $keyword
                    }
                }
            }
        }
    } catch {
        Write-Warning "‚ùå Error processing GPO: $($gpo.DisplayName)"
    }
}

# üì§ Display only the matched GPOs
$gposAtRisk | Sort-Object GPOName | Format-Table -AutoSize

#$gposAtRisk | Export-Csv -Path "C:\Temp\GPOs_LinkedToSensitiveScopes.csv" -NoTypeInformation -Encoding UTF8
```

This helps correlate dangerous permissions with privileged application scope, which is where the real risk lies.

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-26-10-32-35.png)


You can also find which GPO are linked to privileged objects, that exclude Built-in trustees (like "Domain Admins", "Enterprise Admins", "SYSTEM") :

```powershell
$SensitiveOUKeywords = @(
    "Domain Controllers",
    "PRIVILEGED",
    "Domain Admins",
    "Tier0",
    "Tier 0"
)

$allowedTrustees = @(
    "domain admins",
    "enterprise admins",
    "system"
)

$gposAtRisk = @()

Get-GPO -All | ForEach-Object {
    $gpo = $_
    try {
        $xml = [xml](Get-GPOReport -Guid $gpo.Id -ReportType Xml)
        $links = $xml.GPO.LinksTo.SOMPath

        foreach ($link in $links) {
            foreach ($keyword in $SensitiveOUKeywords) {
                if ($link -like "*$keyword*") {
                    Write-Host "`nüîó GPO '$($gpo.DisplayName)' linked to '$link' (matched on '$keyword')" -ForegroundColor Cyan

                    $permissions = Get-GPPermissions -Name $gpo.DisplayName -All

                    foreach ($entry in $permissions) {
                        $trustee = $entry.Trustee.Name.ToLower()
                        $permission = $entry.Permission
                        $isEdit = $permission -like "*Edit*"
                        $isAllowed = $allowedTrustees -contains $trustee

                        Write-Host "üîç Trustee: $($entry.Trustee.Name), Permission: $permission, IsEdit: $isEdit, IsAllowed: $isAllowed"

                        if ($isEdit -and -not $isAllowed) {
                            Write-Host "üö® Adding GPO to report: $($gpo.DisplayName)" -ForegroundColor Yellow
                            $gposAtRisk += [PSCustomObject]@{
                                GPOName     = $gpo.DisplayName
                                LinkedTo    = $link
                                Trustee     = $entry.Trustee.Name
                                TrusteeType = $entry.TrusteeType
                                Permission  = $entry.Permission
                                MatchedOU   = $keyword
                            }
                        }
                    }
                }
            }
        }
    } catch {
        Write-Warning "‚ùå Error processing GPO: $($gpo.DisplayName)"
    }
}

# R√©sultat final
Write-Host "###########" -ForegroundColor Red
Write-Host "GPO at Risk" -ForegroundColor Red
$gposAtRisk | Sort-Object GPOName | Format-Table -AutoSize
#$gposAtRisk | Export-Csv -Path "C:\Temp\GPOsAtRisk.csv" -NoTypeInformation -Encoding UTF8
```


### Audit SYSVOL ACLs

Even if LDAP permissions are correct, GPOs can still be exploited if SYSVOL folders are misconfigured:

```powershell
# ‚úÖ Trusted accounts that are allowed to have write access on SYSVOL
$allowedTrustees = @(
    "BUILTIN\Administrators",
    "NT AUTHORITY\SYSTEM",
    "ENTERPRISE DOMAIN CONTROLLERS",
    "$env:USERDOMAIN\Domain Admins",
    "$env:USERDOMAIN\Enterprise Admins",
    "CREATOR OWNER",
    "$env:USERDOMAIN\Group Policy Creator Owners"
)

# Store at-risk GPO folders
$gpoFoldersAtRisk = @()

# Define SYSVOL Policies path
$domain = $env:USERDNSDOMAIN
$sysvolPoliciesPath = "\\$domain\SYSVOL\$domain\Policies"

# Get all GPOs (to map GUID ‚Üí DisplayName)
$allGPOs = Get-GPO -All | Group-Object -Property Id -AsHashTable -AsString

# Enumerate all GPO folders
Get-ChildItem -Path $sysvolPoliciesPath | ForEach-Object {
    $folder = $_
    $acl = Get-Acl $folder.FullName

    # Extract GUID from folder name
    $guid = $folder.Name.Trim("{}")
    $gpoName = if ($allGPOs.ContainsKey($guid)) {
        $allGPOs[$guid].DisplayName
    } else {
        "[Unknown GPO name]"
    }

    foreach ($entry in $acl.Access) {
        $trustee = $entry.IdentityReference.Value
        $rights = $entry.FileSystemRights.ToString()

        # üéØ Check if trustee is not allowed and has write-level rights
        $isWrite = $rights -match "Write|Modify|FullControl"
        $isAllowed = $allowedTrustees -contains $trustee

        if ($isWrite -and -not $isAllowed) {
            $gpoFoldersAtRisk += [PSCustomObject]@{
                GPOName          = $gpoName
                GPO_GUID         = $guid
                Trustee          = $trustee
                AccessRights     = $rights
                Inheritance      = $entry.IsInherited
                AccessType       = $entry.AccessControlType
                FolderName       = $folder.Name
            }
        }
    }
}

# Output
if ($gpoFoldersAtRisk.Count -gt 0) {
    Write-Host "`nüö® SYSVOL folders with suscpicisous unauthorized write access:" -ForegroundColor Red
    $gpoFoldersAtRisk | Sort-Object GPOName | Format-Table -AutoSize
} else {
    Write-Host "`n‚úÖ No unauthorized write access found on SYSVOL folders." -ForegroundColor Green
}

# Optional export
# $gpoFoldersAtRisk | Export-Csv "C:\Temp\SYSVOL_GPO_ACLs_AtRisk.csv" -NoTypeInformation -Encoding UTF8
```

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-26-10-54-16.png)

You should review any GPO folder where suscpicious groups or account (like Everyone, Authenticated Users, or Domain Users, sp√©cific user) have write access.

---

## 5. Remediation

Once suspicious permissions have been identified using the previous scripts, a manual review is required to validate and secure the affected GPOs.

- Review suspicious GPOs (LDAP ACL)
Start by reviewing GPOs flagged as exposed, and remove any unauthorized users or groups with edit-level rights.

You can use the Set-GPPermissions cmdlet or the Group Policy Management Console (gpmc.msc) to adjust permissions and ensure only trusted admin groups (e.g., Domain Admins) retain edit rights.

- Review SYSVOL NTFS permissions
For GPOs where NTFS permissions were flagged as risky, open the corresponding SYSVOL folder and ensure only authorized accounts have write access.

Use the output of the script to identify which GPO folders need investigation.


### Azure AD Connect: Use Set-ADSyncRestrictedPermissions

If your environment uses Azure AD Connect, ensure that its service account does not introduce unwanted control paths.

To lock down delegated permissions:

```powershell
Import-Module .\AdSyncConfig.psm1
$credential = Get-Credential
Set-ADSyncRestrictedPermissions -ADConnectorAccountDN "CN=ExampleUser,CN=Users,DC=domain,DC=com" -Credential $credential
```

The module can be extracted from the Azure AD Connect installer:

```powershell
msiexec /a "AzureADConnect.msi" /qb TARGETDIR=C:\Temp\AADConnectExtract
```

---

## 6. Accepting the Risk: Edge Cases

In some cases, certain non-Tier 0 accounts legitimately require elevated permissions ‚Äî for example, automation accounts, helpdesk roles, or Azure AD Connect service accounts. However, these delegations must be treated as privileged and protected accordingly.

### Treat Delegated Accounts as Tier 0

If a user or group has control over a GPO applied to privileged users (e.g., Domain Admins), they must themselves be considered privileged. This includes:

* Applying stricter ACLs on the delegated group
* Preventing inheritance from less secure parent OUs
* Isolating these accounts in Tier 0 scopes

---

## 7. Useful Links / Appendices

### üîó Microsoft Documentation & Tools

- Azure AD Connect Download (official) : https://go.microsoft.com/fwlink/?LinkId=615771
- KB5008383 - November 2021 update ‚Äì Fixes control paths involving OWNER and WRITE_OWNER : https://support.microsoft.com/help/5008383
- Understanding adminSDHolder and SDPROP : https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-adminsdholder
- Set-ADSyncRestrictedPermissions documentation : https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-configure-secure-ldap

### üìö Related Tools (Mentioned)

- BloodHound GitHub : https://github.com/BloodHoundAD/BloodHound
- PingCastle : https://www.pingcastle.com/


---

## Conclusion

Misconfigured ACLs, especially on GPOs tied to privileged accounts, are a critical but often overlooked risk in Active Directory. By proactively auditing permissions, applying least privilege principles, and leveraging PowerShell automation, defenders can eliminate most control paths before they become exploitation vectors.

Stay vigilant, test regularly, and treat GPOs like the Tier 0 assets they truly are.
