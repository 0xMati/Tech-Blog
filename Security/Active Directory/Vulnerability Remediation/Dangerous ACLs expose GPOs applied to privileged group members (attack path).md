# Dangerous ACLs expose GPOs applied to privileged group members (attack path)
üóìÔ∏è Published: 2025-05-06


## üß± 1. Introduction

### What is a control path in Active Directory

A control path in Active Directory refers to a sequence of permissions that allows a user or group to gain control over a target object, either directly or indirectly, by chaining access rights across multiple objects.
In simpler terms, it‚Äôs the ‚Äúpath‚Äù that an attacker could follow‚Äîvia delegated permissions, misconfigured ACLs, or inherited rights‚Äîto escalate privileges or compromise critical AD components.
Control paths are typically built using:
- Access Control Entries (ACEs) that allow rights like GenericAll, WriteDacl, WriteOwner, or AllExtendedRights.
- Object relationships, such as Group Membership, OU delegation, or GPO application.
- Privilege boundaries not being respected (e.g., standard users controlling GPOs linked to Domain Admins).

These paths are often non-obvious and span multiple AD layers. A user might not have direct rights over a Domain Admin account, but might control a GPO applied to it, or be able to modify an object that eventually affects it.

![](assets/Dangerous%20ACLs%20expose%20GPOs%20applied%20to%20privileged%20group%20members%20(attack%20path)/2025-05-06-22-53-21.png)

This diagram illustrates a privilege escalation control path in Active Directory:

- UserA has GenericWrite rights on Group1, allowing them to modify its membership.
- Group1 is a member of GPOE2, so UserA indirectly gains influence over GPOE2.
- GPOE2 has GPOEdit rights on GPO_Admins, meaning its members can edit the GPO.
- GPO_Admins is applied to the Domain Admins OU ‚Äî any changes to this GPO affect Domain Admins.
‚û°Ô∏è Result: UserA can escalate privileges and potentially compromise Domain Admins via this chain of misconfigured permissions.

### Why misconfigured ACLs are dangerous

Access Control Lists (ACLs) in Active Directory define who can interact with directory objects and what actions they can perform ‚Äî from reading attributes to modifying group memberships or delegating control.
When ACLs are misconfigured, they can unintentionally grant users or groups privileged access over critical objects such as:
- Group Policy Objects (GPOs)
- Organizational Units (OUs)
- Security groups (including Domain Admins)
- User or computer accounts

This creates opportunities for privilege escalation, persistence mechanisms, and even full domain compromise. Attackers often exploit these weaknesses post-compromise, using tools like BloodHound to identify and follow control paths that stem from over-permissive ACLs.

Even a single ACE (Access Control Entry) granting GenericAll, WriteDACL, or GenericWrite on a sensitive object can be the starting point of a complete Active Directory takeover.
ACLs are especially dangerous when:
- Inheritance is enabled inappropriately.
- Legacy delegation models are still in place.
- Groups like Authenticated Users or Domain Users are granted write permissions to privileged objects.

### Typical exploitation context: post-compromise attacks, persistence, privilege escalation.

Once an attacker has initial access in an Active Directory environment ‚Äî often as a low-privileged user ‚Äî they will look for misconfigured ACLs to move laterally or escalate privileges.
Here are common scenarios:
- üß¨ GPO Hijacking: An attacker with edit rights on a GPO applied to privileged users can deploy malicious logon scripts or scheduled tasks to execute code with elevated privileges.
- üîÅ Group Membership Manipulation: With GenericWrite or WriteMembers rights over a group, an attacker can add themselves to a group that is indirectly linked to high privileges.
- üîì WriteDACL Abuse: The ability to modify an object‚Äôs ACL allows the attacker to grant themselves full control (GenericAll), effectively owning the object.
- üß± OU Delegation Abuse: Poorly delegated permissions at the OU level can expose multiple child objects (users, groups, computers) to compromise.

These attack techniques are not theoretical ‚Äî they have been observed in real-world breaches, and often form the core of post-exploitation playbooks using tools like BloodHound, PowerView, or ADExplorer.

---

## üîç 2. Root Cause of the Vulnerability

This article specifically focuses on a critical misconfiguration scenario:
"Dangerous ACLs exposing Group Policy Objects (GPOs) that are applied to privileged group members", such as Domain Admins, Enterprise Admins, or other Tier 0 accounts.

In this case, the root cause lies in excessive or poorly managed permissions set on GPO objects in Active Directory. These permissions are stored in two places:

- The LDAP object representing the GPO (in CN=Policies,CN=System,...)
- The corresponding SYSVOL folder that stores the actual GPO scripts and policies

When any user or group has write access (GpoEdit, Write, GenericWrite, WriteDACL, etc.) to one of these layers, they can:

- Modify GPO settings to run malicious scripts
- Apply registry modifications
- Alter login/logoff behavior for privileged users

### üîÅ Common Root Causes

* GPOs linked to privileged user scopes (e.g., OU containing Domain Admins) are not secured and allow modification by non-Tier 0 users.
* Legacy delegation models that granted permissions to groups like ITSupport, HelpDesk, or even Authenticated Users.
* ACL drift: Permissions in LDAP are not kept in sync with permissions in the SYSVOL folder.
* Inherited permissions allow downstream access unintentionally.
* Azure AD Connect service accounts or other delegated identities are over-permissioned for convenience.

### üõ°Ô∏è Consequences

If a GPO applied to a privileged group is compromised, an attacker can:
- Run code as a Domain Admin at logon
- Maintain persistence by continuously reapplying malicious settings
- Pivot to other systems with higher privileges

## üõ†Ô∏è 3. How an Attacker Exploits This Vulnerability

Misconfigured ACLs on GPOs applied to privileged users open a direct and often invisible path for attackers to escalate privileges or maintain long-term persistence in an Active Directory environment.

### üéØ Example Exploitation Path

Let‚Äôs walk through a concrete scenario:

1. Initial foothold: The attacker compromises UserA, a standard domain user.
2. Privilege reconnaissance: Using tools like BloodHound, the attacker identifies that UserA has GenericWrite rights over Group1.
3. Lateral control: Group1 is a member of Group2, which has GpoEdit rights over GPO_Admins.
4. Privilege escalation: GPO_Admins is linked to the OU that contains Domain Admins.
5. Attack execution: The attacker edits the GPO to deploy a logon script or scheduled task that executes malicious code as a Domain Admin during their next logon.
‚û°Ô∏è In just a few steps, the attacker has moved from a low-privileged account to full domain control.

### üîß Techniques Used

* BloodHound: To map Active Directory relationships and identify exploitable control paths (queries like "Shortest path to Domain Admins").
* GPMC / PowerView: To list and analyze GPO permissions (e.g., Get-GPPermissions).
* Malicious GPO payloads:
    * Logon/logoff scripts
    * Startup scripts
    * Scheduled tasks
    * Registry modifications (e.g., Run key persistence)

### üï≥Ô∏è Why This Works

In many environments:

* GPOs are not treated as Tier 0 objects, even when linked to Tier 0 users.
* Delegation is often excessive, and not reviewed regularly.
* SYSVOL permissions may not be synchronized with LDAP ACLs.
* No auditing or alerting is configured for changes on sensitive GPOs.

This makes GPOs an attractive and stealthy vector for attackers, especially because GPO changes are rarely flagged by traditional endpoint or SIEM solutions.

## üß∞ 4. Detection

There are several tools available to detect dangerous ACLs in Active Directory‚Äîsuch as BloodHound or PingCastle‚Äîwhich are widely used for visualizing attack paths and assessing overall AD health.
‚û°Ô∏è However, this article focuses on PowerShell-based detection, offering a direct and scriptable way to audit GPO permissions and identify exposure points.

### üíª Identify GPOs with Edit Permissions

To list all GPOs where users or groups have edit-level permissions (such as GpoEdit, GpoEditDeleteModifySecurity, etc.):

```powershell
Get-GPPermissions -All -Domain yourdomain.local | Where-Object {
    $_.Permission -like "*Edit*"
} | Format-Table GPOName, Trustee, TrusteeType, Permission
```

This will highlight any GPO where a non-Tier 0 user or group may have dangerous control.

### üìå Identify GPOs Linked to Privileged Scopes

You can also find which GPOs are linked to OUs containing privileged users, such as Domain Admins or other Tier 0 accounts:

```powershell
Get-GPO -All | ForEach-Object {
    $report = Get-GPOReport -Guid $_.Id -ReportType Xml
    if ($report -match "Domain Admins|Enterprise Admins|OU=Tier0") {
        $_.DisplayName
    }
}
```

This helps correlate dangerous permissions with privileged application scope, which is where the real risk lies.

### üßæ Audit SYSVOL ACLs

Even if LDAP permissions are correct, GPOs can still be exploited if SYSVOL folders are misconfigured:

```powershell
Get-ChildItem "\\$env:USERDNSDOMAIN\SYSVOL\$env:USERDNSDOMAIN\Policies" |
ForEach-Object {
    Get-Acl $_.FullName | Select-Object PSPath, AccessToString
} | Where-Object { $_.AccessToString -match "Everyone|Authenticated Users" }
```

You should review any GPO folder where broadly scoped groups (like Everyone, Authenticated Users, or Domain Users) have write access.

### üîé Detect Dangerous ACEs (e.g., GenericWrite, WriteDacl) on AD Objects

Beyond GPOs, attackers often target objects like users, groups, or OUs with overly permissive ACLs. The following PowerShell commands help identify such risky entries, focusing on Access Control Entries (ACEs) that grant sensitive rights.

üß™ Example: Find All Objects Where a Specific User Has GenericWrite

```powershell
$searcher = [ADSISearcher]"(objectClass=*)"
$searcher.PageSize = 1000
$results = $searcher.FindAll()

foreach ($result in $results) {
    $dn = $result.Properties.distinguishedname
    try {
        $acl = Get-Acl ("AD:\" + $dn)
        foreach ($ace in $acl.Access) {
            if ($ace.IdentityReference -like "*StandardUser*" -and $ace.ActiveDirectoryRights -match "GenericWrite") {
                Write-Output "$($ace.IdentityReference) has GenericWrite on $dn"
            }
        }
    } catch {
        # Ignore objects where ACL cannot be retrieved (common for certain system containers)
    }
}
```
üîÑ Replace "*StandardUser*" with the username or group you're auditing.

üìö Detect All WriteDacl, WriteOwner, GenericAll, etc.

You can extend the previous script by checking for a list of sensitive rights:

```powershell
$dangerousRights = "GenericAll", "GenericWrite", "WriteDacl", "WriteOwner"

foreach ($result in $results) {
    $dn = $result.Properties.distinguishedname
    try {
        $acl = Get-Acl ("AD:\" + $dn)
        foreach ($ace in $acl.Access) {
            foreach ($right in $dangerousRights) {
                if ($ace.ActiveDirectoryRights -match $right) {
                    Write-Output "$($ace.IdentityReference) has $right on $dn"
                }
            }
        }
    } catch { }
}
```
üí° This method can reveal indirect attack paths if dangerous ACEs are granted on groups or OUs linked to privileged accounts.



## üßº 5. Remediation

Once dangerous ACLs have been identified on GPOs applied to privileged groups, immediate action should be taken to secure these objects and prevent privilege escalation.

### üîê Review and Restrict GPO Permissions (LDAP ACL)

To review permissions on a specific GPO:

```powershell
Get-GPPermissions -Name "GPO_Admins" -All
```

To remove inappropriate permissions:

```powershell
Set-GPPermissions -Name "GPO_Admins" -TargetName "StandardUser" -TargetType User -PermissionLevel None
```

To grant rights only to trusted admin groups (e.g., Domain Admins):

```powershell
Set-GPPermissions -Name "GPO_Admins" -TargetName "Domain Admins" -TargetType Group -PermissionLevel GpoEdit
```

‚úÖ Use GPMC (gpmc.msc) for manual verification, which also ensures correct synchronization between LDAP and SYSVOL.

### üîÑ Ensure LDAP ‚Üî SYSVOL Permissions Synchronization

Changes made in gpmc.msc automatically apply to both LDAP and the SYSVOL folder.
However, when changes are scripted or manual, verify that the file system permissions (NTFS) in \\<domain>\SYSVOL\... are also aligned:

```powershell
$gpoPath = "\\yourdomain.local\SYSVOL\yourdomain.local\Policies\{GPO-GUID}"
Get-Acl $gpoPath | Format-List
```

If needed, manually adjust NTFS permissions to reflect the same trusted admin groups only.

### üß∞ Apply Microsoft Patches (when applicable)

Certain control path issues were mitigated in Microsoft updates. For example:
* KB5008383 (Nov 2021) closes the OWNER and WRITE_OWNER path on computer accounts.

Keep all domain controllers fully patched to ensure these fixes are effective across your environment.

### ‚òÅÔ∏è Azure AD Connect: Use Set-ADSyncRestrictedPermissions

If your environment uses Azure AD Connect, ensure that its service account does not introduce unwanted control paths.

To lock down delegated permissions:

```powershell
Import-Module .\AdSyncConfig.psm1
$credential = Get-Credential
Set-ADSyncRestrictedPermissions -ADConnectorAccountDN "CN=ExampleUser,CN=Users,DC=domain,DC=com" -Credential $credential
```

üì• The module can be extracted from the Azure AD Connect installer:

```powershell
msiexec /a "AzureADConnect.msi" /qb TARGETDIR=C:\Temp\AADConnectExtract
```

## üîí 6. Accepting the Risk: Edge Cases

In some cases, certain non-Tier 0 accounts legitimately require elevated permissions ‚Äî for example, automation accounts, helpdesk roles, or Azure AD Connect service accounts. However, these delegations must be treated as privileged and protected accordingly.

### üõ°Ô∏è Treat Delegated Accounts as Tier 0

If a user or group has control over a GPO applied to privileged users (e.g., Domain Admins), they must themselves be considered privileged. This includes:

* Applying stricter ACLs on the delegated group
* Preventing inheritance from less secure parent OUs
* Isolating these accounts in Tier 0 scopes

### üîí Apply adminSDHolder Protection (if applicable)

To protect delegated accounts like Tier 0 admins, adminSDHolder inheritance can be enforced manually:

```powershell
# Example: force SDPROP inheritance from adminSDHolder
$adminSD = Get-ADObject -Identity "CN=adminSDHolder,CN=System,DC=domain,DC=com" -Properties ntSecurityDescriptor
Set-ACL -Path "AD:\CN=DelegatedGroup,CN=Users,DC=domain,DC=com" -AclObject $adminSD.ntSecurityDescriptor
```

‚ö†Ô∏è Be cautious ‚Äî this overwrites the ACL and should be tested beforehand.

### üß∞ Use Set-ADSyncRestrictedPermissions Recursively

As previously shown, the Set-ADSyncRestrictedPermissions cmdlet can be used not only on the Azure AD Connect account, but also on all members of a delegated group, recursively:

```powershell
Get-ADGroupMember -Identity "DelegatedGroup" -Recursive | ForEach-Object {
    Set-ADSyncRestrictedPermissions -ADConnectorAccountDN $_.DistinguishedName -Credential $credential
}
```

### ‚úÖ Summary of Risk Acceptance Measures

| Requirement                         | Action                                                |
| ----------------------------------- | ----------------------------------------------------- |
| Delegated group controls Tier 0 GPO | Treat the group as Tier 0                             |
| Group members can inherit risk      | Apply protections recursively                         |
| GPO control cannot be revoked       | Restrict logon, apply adminSDHolder, isolate accounts |


## üìé 7. Useful Links / Appendices

### üîó Microsoft Documentation & Tools

- Azure AD Connect Download (official) : https://go.microsoft.com/fwlink/?LinkId=615771
- KB5008383 - November 2021 update ‚Äì Fixes control paths involving OWNER and WRITE_OWNER : https://support.microsoft.com/help/5008383
- Understanding adminSDHolder and SDPROP : https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-adminsdholder
- Set-ADSyncRestrictedPermissions documentation : https://learn.microsoft.com/en-us/azure/active-directory/hybrid/how-to-connect-configure-secure-ldap

### üìö Related Tools (Mentioned)

- BloodHound GitHub : https://github.com/BloodHoundAD/BloodHound
- PingCastle : https://www.pingcastle.com/


---

## üßæ Conclusion

Misconfigured ACLs, especially on GPOs tied to privileged accounts, are a critical but often overlooked risk in Active Directory. By proactively auditing permissions, applying least privilege principles, and leveraging PowerShell automation, defenders can eliminate most control paths before they become exploitation vectors.

Stay vigilant, test regularly, and treat GPOs like the Tier 0 assets they truly are.
