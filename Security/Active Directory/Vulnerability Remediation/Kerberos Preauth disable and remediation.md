# üõ°Ô∏è Remediating Kerberos Pre-Authentication Disabled Accounts
üóìÔ∏è Published: 2025-05-26

## üîç Overview

Kerberos pre-authentication is a built-in security mechanism that prevents unauthorized actors from requesting authentication tickets (TGTs) without proving knowledge of a user's password. Disabling pre-authentication on an account (via the `DONT_REQ_PREAUTH` flag) opens the door to **AS-REP Roasting attacks**, where an attacker can request an AS-REP response and attempt to brute-force the password offline.

This guide provides a step-by-step remediation plan to identify, assess, and secure accounts that have pre-authentication disabled.

---

## üìå Why it matters

Accounts with Kerberos pre-authentication disabled allow attackers to:
- Request authentication tickets without proof of password ownership
- Perform offline password cracking attacks (AS-REP Roasting)
- Target privileged or service accounts without triggering alerts

---

## ‚úÖ Remediation Plan

### 1. Identify vulnerable accounts

Run the following PowerShell command to list all accounts with pre-authentication disabled:

```powershell
Get-ADUser -Filter {DoesNotRequirePreAuth -eq $true} -Properties SamAccountName, Description, ServicePrincipalName, LastLogonDate, PasswordLastSet |
Select-Object SamAccountName, Description, ServicePrincipalName, LastLogonDate, PasswordLastSet
```

Review these accounts for:
- Unused or obsolete entries
- Service accounts with active SPNs
- Recently used logon dates

---

### 2. Reactivate Pre-Authentication (One account at a time)

Use the following command to re-enable pre-authentication:

```powershell
Set-ADUser -Identity "AccountName" -DoesNotRequirePreAuth $false
```

Preferably, test this change in a staging environment or with a monitored subset of accounts in production.

---

### 3. Monitor Event ID 4768 with ResultCode 0x19

After enabling pre-authentication, monitor for authentication failures that suggest a client is still attempting to authenticate without it:

#### In PowerShell:
```powershell
Get-WinEvent -FilterHashtable @{LogName='Security'; ID=4768} |
Where-Object { $_.Properties[6].Value -eq "0x19" }
```

- `0x19` indicates the client sent an AS-REQ without pre-auth, but the KDC required it.
- If seen after re-enabling pre-auth: a client or service still needs to be updated.

---

### 4. Document and Evaluate

- Accounts with no 4768/0x19 events after the change are considered **safe to remediate permanently**.
- Accounts with repeated 4768/0x19 errors require further investigation (e.g. legacy systems, scripts, or third-party applications).

---

## üß† Best Practices

- Always test changes on a non-critical account first.
- Ensure Kerberos auditing is enabled:
```powershell
auditpol /set /subcategory:"Kerberos Authentication Service" /success:enable /failure:enable
```
- Document each change, including logon activity and application ownership.

---

## üõë Summary

Re-enabling pre-authentication on AD accounts is a critical step toward mitigating AS-REP Roasting attacks. By gradually applying changes, monitoring authentication events, and engaging application owners, you can secure your environment without impacting production systems.
